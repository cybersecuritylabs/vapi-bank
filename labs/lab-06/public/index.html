<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ShopAPI â€” E-Commerce</title>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;background:#fffbeb;color:#1e293b;min-height:100vh}
.topbar{background:linear-gradient(135deg,#ea580c,#f59e0b);color:#fff;padding:0 2rem;height:60px;display:flex;align-items:center;justify-content:space-between}
.topbar h1{font-size:1.125rem;font-weight:700;display:flex;align-items:center;gap:0.5rem}
.topbar h1 svg{width:24px;height:24px}
.container{max-width:900px;margin:2rem auto;padding:0 1.5rem}
.grid{display:grid;grid-template-columns:2fr 1fr;gap:1.25rem}
.card{background:#fff;border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,0.06);padding:1.5rem;margin-bottom:1rem;border:1px solid #fef3c7}
.card h2{font-size:1rem;font-weight:600;margin-bottom:0.75rem;color:#92400e;display:flex;align-items:center;gap:0.5rem}
.card h2 svg{width:18px;height:18px;color:#f59e0b}
.product{display:flex;justify-content:space-between;align-items:center;padding:0.75rem 0;border-bottom:1px solid #fef3c7;font-size:0.875rem}
.product:last-child{border-bottom:none}
.product .name{font-weight:500}
.product .price{color:#ea580c;font-weight:700}
.btn{padding:0.5rem 0.875rem;border:none;border-radius:8px;font-size:0.8125rem;font-weight:600;cursor:pointer;font-family:inherit;transition:all 0.15s}
.btn-orange{background:#f59e0b;color:#fff}.btn-orange:hover{background:#d97706}
.btn-block{width:100%}
.btn-sm{padding:0.375rem 0.625rem;font-size:0.75rem}
.btn-danger{background:#ef4444;color:#fff}
.btn-outline{background:transparent;border:1.5px solid #fef3c7;color:#92400e;font-size:0.75rem}
.cart-item{display:flex;justify-content:space-between;font-size:0.8125rem;padding:0.5rem 0;border-bottom:1px solid #fef3c7}
.cart-total{display:flex;justify-content:space-between;font-weight:700;font-size:0.9375rem;padding-top:0.75rem;margin-top:0.5rem;border-top:2px solid #fef3c7}
.wallet-badge{background:#fef3c7;color:#92400e;padding:0.25rem 0.75rem;border-radius:999px;font-size:0.8125rem;font-weight:600}
.form-row{margin-bottom:1rem}
.form-row label{display:block;font-size:0.8125rem;font-weight:500;color:#475569;margin-bottom:0.25rem}
.form-row input{width:100%;padding:0.5rem 0.75rem;border:1.5px solid #fef3c7;border-radius:8px;font-size:0.875rem;font-family:inherit}
.form-row input:focus{outline:none;border-color:#f59e0b;box-shadow:0 0 0 3px rgba(245,158,11,0.15)}
.alert{padding:0.75rem;border-radius:8px;font-size:0.8125rem;margin-bottom:1rem;display:none}
.alert-error{background:#fee2e2;color:#991b1b}.alert-success{background:#d1fae5;color:#065f46}
.login-wrapper{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#78350f,#ea580c)}
.login-card{background:#fff;border-radius:16px;padding:2.5rem;max-width:400px;width:100%;box-shadow:0 20px 40px rgba(0,0,0,0.2)}
.login-card h1{text-align:center;font-size:1.375rem;margin-bottom:0.25rem}
.login-card p{text-align:center;color:#64748b;font-size:0.875rem;margin-bottom:2rem}
.login-card .logo{text-align:center;margin-bottom:1.5rem}
.login-card .logo svg{width:48px;height:48px}
.hidden{display:none!important}
.flag-banner{background:linear-gradient(135deg,#10b981,#059669);color:#fff;padding:1rem;border-radius:12px;margin-bottom:1rem;font-family:monospace;font-size:0.875rem;word-break:break-all}
.flag-banner strong{display:block;margin-bottom:0.25rem;font-size:0.75rem;text-transform:uppercase;letter-spacing:0.1em;opacity:0.8}
</style>
</head>
<body>
<div id="loginView" class="login-wrapper">
  <div class="login-card">
    <div class="logo"><svg viewBox="0 0 48 48" fill="none"><rect width="48" height="48" rx="14" fill="#ea580c"/><path d="M14 18h20l-3 14H17L14 18z" fill="none" stroke="#fff" stroke-width="2" stroke-linejoin="round"/><circle cx="20" cy="36" r="2" fill="#fff"/><circle cx="30" cy="36" r="2" fill="#fff"/></svg></div>
    <h1>ShopAPI</h1>
    <p>E-Commerce Platform</p>
    <div id="loginAlert" class="alert alert-error"></div>
    <form id="loginForm">
      <div class="form-row"><label>Username</label><input type="text" id="username" required></div>
      <div class="form-row"><label>Password</label><input type="password" id="password" required></div>
      <button type="submit" class="btn btn-orange btn-block">Sign In</button>
    </form>
  </div>
</div>

<div id="appView" class="hidden">
  <div class="topbar">
    <h1><svg viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2"><path d="M6 6h15l-2 10H8L6 6z"/><circle cx="10" cy="20" r="1.5"/><circle cx="17" cy="20" r="1.5"/></svg> ShopAPI</h1>
    <div>
      <span class="wallet-badge" id="walletBadge">$50.00</span>
      <button class="btn btn-outline btn-sm" style="margin-left:0.5rem" onclick="resetAll()">Reset</button>
      <button class="btn btn-danger btn-sm" style="margin-left:0.25rem" onclick="doLogout()">Logout</button>
    </div>
  </div>
  <div class="container">
    <div id="flagBanner"></div>
    <div class="grid">
      <div>
        <div class="card">
          <h2><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg> Products</h2>
          <div id="productsContainer"></div>
        </div>
      </div>
      <div>
        <div class="card">
          <h2><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg> Cart</h2>
          <div id="cartContainer"><p style="color:#94a3b8;font-size:0.8125rem;">Cart is empty</p></div>
          <div id="checkoutAlert" class="alert" style="margin-top:0.75rem"></div>
          <button class="btn btn-orange btn-block" style="margin-top:0.75rem" onclick="checkout()">Checkout</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const $ = s => document.querySelector(s);

$('#loginForm').addEventListener('submit', async e => {
  e.preventDefault();
  const res = await fetch('/api/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:$('#username').value,password:$('#password').value})});
  const d = await res.json();
  if (!res.ok) {$('#loginAlert').textContent=d.error;$('#loginAlert').style.display='block';return;}
  $('#loginView').classList.add('hidden');$('#appView').classList.remove('hidden');
  loadProducts(); loadCart(); loadWallet();
});

async function loadProducts() {
  const res = await fetch('/api/products'); const d = await res.json();
  $('#productsContainer').innerHTML = d.products.map(p =>
    `<div class="product"><div><span class="name">${p.name}</span></div><div><span class="price">$${p.price}</span> <button class="btn btn-orange btn-sm" onclick="addToCart(${p.id})">Add</button></div></div>`
  ).join('');
}

async function loadCart() {
  const res = await fetch('/api/cart'); const d = await res.json();
  if (d.items.length === 0) { $('#cartContainer').innerHTML = '<p style="color:#94a3b8;font-size:0.8125rem;">Cart is empty</p>'; return; }
  let html = d.items.map(i => `<div class="cart-item"><span>${i.name} (x${i.quantity})</span><span>$${(i.price*i.quantity).toFixed(2)}</span></div>`).join('');
  html += `<div class="cart-total"><span>Total</span><span>$${d.total.toFixed(2)}</span></div>`;
  $('#cartContainer').innerHTML = html;
}

async function loadWallet() {
  const res = await fetch('/api/wallet'); const d = await res.json();
  $('#walletBadge').textContent = '$' + d.balance.toFixed(2);
}

async function addToCart(productId) {
  await fetch('/api/cart',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({productId, quantity:1})});
  loadCart();
}

async function checkout() {
  const alert = $('#checkoutAlert');
  const res = await fetch('/api/checkout',{method:'POST'});
  const d = await res.json();
  if (!res.ok) {alert.className='alert alert-error';alert.textContent=d.error;alert.style.display='block';return;}
  alert.className='alert alert-success';alert.textContent='Order placed: '+d.order.id;alert.style.display='block';
  if (d.order.flag) { $('#flagBanner').innerHTML = `<div class="flag-banner"><strong>Flag Captured</strong>${d.order.flag}</div>`; }
  loadCart(); loadWallet();
}

async function resetAll() { await fetch('/api/reset',{method:'POST'}); loadCart(); loadWallet(); }
function doLogout() { fetch('/api/auth/logout',{method:'POST'}).then(()=>{$('#appView').classList.add('hidden');$('#loginView').classList.remove('hidden');}); }
</script>
</body>
</html>

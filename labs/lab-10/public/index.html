<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CryptoTrade â€” Exchange</title>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;background:#09090b;color:#e4e4e7;min-height:100vh}
.topbar{background:linear-gradient(135deg,#18181b,#27272a);border-bottom:1px solid #3f3f46;padding:0 2rem;height:56px;display:flex;align-items:center;justify-content:space-between}
.topbar h1{font-size:1rem;font-weight:700;color:#fbbf24;display:flex;align-items:center;gap:0.5rem}
.topbar h1 svg{width:22px;height:22px}
.container{max-width:900px;margin:2rem auto;padding:0 1.5rem}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
.card{background:#18181b;border:1px solid #27272a;border-radius:10px;padding:1.25rem;margin-bottom:1rem}
.card h2{font-size:0.875rem;font-weight:600;color:#fbbf24;margin-bottom:0.75rem;display:flex;align-items:center;gap:0.5rem}
.card h2 svg{width:16px;height:16px}
.market-row{display:flex;align-items:center;justify-content:space-between;padding:0.5rem 0;border-bottom:1px solid #27272a}
.market-row:last-child{border-bottom:none}
.pair{font-weight:600;font-size:0.9375rem}
.price{font-family:'JetBrains Mono',monospace;font-size:0.875rem;color:#d4d4d8}
.change{font-size:0.75rem;font-weight:600;padding:0.125rem 0.375rem;border-radius:4px}
.change.up{color:#22c55e;background:rgba(34,197,94,0.1)}.change.down{color:#ef4444;background:rgba(239,68,68,0.1)}
.balance-display{font-size:1.75rem;font-weight:700;color:#fbbf24;margin-bottom:0.25rem}
.balance-label{color:#71717a;font-size:0.75rem;text-transform:uppercase;letter-spacing:0.1em}
.form-row{margin-bottom:0.75rem}
.form-row label{display:block;font-size:0.75rem;color:#a1a1aa;margin-bottom:0.25rem}
.form-row input,.form-row select{width:100%;padding:0.5rem;background:#09090b;border:1px solid #3f3f46;border-radius:6px;color:#e4e4e7;font-size:0.8125rem;font-family:inherit}
.form-row input:focus,.form-row select:focus{outline:none;border-color:#fbbf24;box-shadow:0 0 0 2px rgba(251,191,36,0.15)}
.btn{padding:0.5rem 1rem;border:none;border-radius:6px;font-size:0.8125rem;font-weight:600;cursor:pointer;font-family:inherit;transition:all 0.15s}
.btn-gold{background:linear-gradient(135deg,#f59e0b,#d97706);color:#000}.btn-gold:hover{background:linear-gradient(135deg,#fbbf24,#f59e0b)}
.btn-sm{padding:0.375rem 0.5rem;font-size:0.6875rem}
.btn-danger{background:#dc2626;color:#fff}
.btn-outline{background:transparent;border:1px solid #3f3f46;color:#a1a1aa;cursor:pointer;font-family:inherit;font-size:0.8125rem;padding:0.5rem 1rem;border-radius:6px}
.btn-outline:hover{border-color:#fbbf24;color:#fbbf24}
.alert{padding:0.75rem;border-radius:6px;font-size:0.8125rem;margin-bottom:1rem;display:none}
.alert-error{background:rgba(239,68,68,0.1);color:#fca5a5;border:1px solid rgba(239,68,68,0.2)}
.alert-success{background:rgba(34,197,94,0.1);color:#86efac;border:1px solid rgba(34,197,94,0.2)}
.login-wrapper{min-height:100vh;display:flex;align-items:center;justify-content:center;background:#09090b}
.login-card{background:#18181b;border:1px solid #27272a;border-radius:14px;padding:2.5rem;max-width:380px;width:100%}
.login-card h1{text-align:center;font-size:1.375rem;color:#fbbf24;margin-bottom:0.25rem}
.login-card p{text-align:center;color:#71717a;font-size:0.8125rem;margin-bottom:2rem}
.login-card .logo{text-align:center;margin-bottom:1.5rem}
.login-card .logo svg{width:48px;height:48px}
.hidden{display:none!important}
.flag-banner{background:linear-gradient(135deg,#f59e0b,#d97706);color:#000;padding:1rem;border-radius:10px;margin-bottom:1rem;font-family:monospace;font-size:0.875rem;word-break:break-all}
.flag-banner strong{display:block;margin-bottom:0.25rem;font-size:0.6875rem;text-transform:uppercase;letter-spacing:0.1em;opacity:0.6}
.console-box{background:#09090b;border:1px solid #27272a;border-radius:6px;padding:0.75rem;font-family:'JetBrains Mono',monospace;font-size:0.75rem;white-space:pre-wrap;max-height:250px;overflow-y:auto;color:#71717a;margin-top:0.5rem}
.console-box .ok{color:#22c55e}.console-box .err{color:#ef4444}.console-box .warn{color:#fbbf24}
.webhook-item{display:flex;align-items:center;justify-content:space-between;padding:0.5rem 0;border-bottom:1px solid #27272a;font-size:0.8125rem}
.webhook-item:last-child{border-bottom:none}
.webhook-url{color:#fbbf24;word-break:break-all;max-width:60%}
</style>
</head>
<body>
<div id="loginView" class="login-wrapper">
  <div class="login-card">
    <div class="logo"><svg viewBox="0 0 48 48" fill="none"><rect width="48" height="48" rx="14" fill="#18181b" stroke="#3f3f46" stroke-width="2"/><path d="M24 10v28M16 16l8-6 8 6M16 32l8 6 8-6" stroke="#fbbf24" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
    <h1>CryptoTrade</h1>
    <p>Digital Asset Exchange</p>
    <div id="loginAlert" class="alert"></div>
    <form id="loginForm">
      <div class="form-row"><label>Username</label><input type="text" id="username" value="trader" required></div>
      <div class="form-row"><label>Password</label><input type="password" id="password" value="trade2024" required></div>
      <button type="submit" class="btn btn-gold" style="width:100%">Sign In</button>
    </form>
  </div>
</div>

<div id="appView" class="hidden">
  <div class="topbar">
    <h1><svg viewBox="0 0 24 24" fill="none" stroke="#fbbf24" stroke-width="2"><path d="M12 2v20M17 5l-5-3-5 3M17 19l-5 3-5-3"/></svg> CryptoTrade</h1>
    <div style="display:flex;align-items:center;gap:0.75rem">
      <span style="color:#a1a1aa;font-size:0.8125rem" id="userInfo">trader</span>
      <button class="btn btn-danger btn-sm" onclick="doLogout()">Logout</button>
    </div>
  </div>
  <div class="container">
    <div id="flagBanner"></div>

    <div class="grid-2">
      <div class="card">
        <h2><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg> Portfolio</h2>
        <div class="balance-label">Total Balance (USDT)</div>
        <div class="balance-display" id="balance">$0.00</div>
      </div>
      <div class="card">
        <h2><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg> Quick Trade</h2>
        <div class="form-row">
          <select id="tradePair"><option>BTC/USDT</option><option>ETH/USDT</option><option>SOL/USDT</option></select>
        </div>
        <div class="form-row"><input type="number" id="tradeAmount" placeholder="Amount" step="0.01"></div>
        <div style="display:flex;gap:0.5rem">
          <button class="btn btn-gold" style="flex:1" onclick="executeTrade('buy')">Buy</button>
          <button class="btn btn-outline" style="flex:1" onclick="executeTrade('sell')">Sell</button>
        </div>
      </div>
    </div>

    <div class="card">
      <h2><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg> Live Markets</h2>
      <div id="marketList"></div>
    </div>

    <div class="card">
      <h2><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg> Webhooks</h2>
      <div class="form-row"><label>Webhook URL</label><input type="text" id="webhookUrl" placeholder="http://..."></div>
      <div style="display:flex;gap:0.5rem;margin-bottom:1rem">
        <button class="btn btn-gold" onclick="addWebhook()">Register Webhook</button>
      </div>
      <div id="webhookList"></div>
      <div class="console-box" id="webhookOutput">// Webhook test results appear here...</div>
    </div>

    <div class="card">
      <h2><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg> API Explorer</h2>
      <p style="font-size:0.8125rem;color:#71717a;margin-bottom:0.75rem">Test API endpoints directly.</p>
      <div class="form-row"><label>Endpoint</label><input type="text" id="apiEndpoint" placeholder="/api/trade/history?from=invalid" value="/api/trade/execute"></div>
      <div class="form-row"><label>Method</label>
        <select id="apiMethod"><option>GET</option><option>POST</option></select>
      </div>
      <button class="btn btn-outline" onclick="callApi()">Send Request</button>
      <div class="console-box" id="apiOutput">// Response...</div>
    </div>
  </div>
</div>

<script>
const $ = s => document.querySelector(s);

$('#loginForm').addEventListener('submit', async e => {
  e.preventDefault();
  const r = await fetch('/api/auth/login', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username: $('#username').value, password: $('#password').value }) });
  const d = await r.json();
  if (!r.ok) { $('#loginAlert').className = 'alert alert-error'; $('#loginAlert').textContent = d.error; $('#loginAlert').style.display = 'block'; return; }
  $('#loginView').classList.add('hidden'); $('#appView').classList.remove('hidden');
  $('#userInfo').textContent = d.user.username;
  $('#balance').textContent = '$' + d.user.balance.toLocaleString();
  loadMarkets(); loadWebhooks();
});

async function loadMarkets() {
  const r = await fetch('/api/markets'); const d = await r.json();
  $('#marketList').innerHTML = d.markets.map(m =>
    `<div class="market-row"><span class="pair">${m.pair}</span><span class="price">$${m.price.toLocaleString()}</span><span class="change ${m.change24h >= 0 ? 'up' : 'down'}">${m.change24h >= 0 ? '+' : ''}${m.change24h}%</span></div>`
  ).join('');
}

async function executeTrade(side) {
  const r = await fetch('/api/trade/execute', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ pair: $('#tradePair').value, amount: parseFloat($('#tradeAmount').value), side }) });
  const d = await r.json();
  $('#apiOutput').innerHTML = `<span class="${r.ok ? 'ok' : 'warn'}">${JSON.stringify(d, null, 2)}</span>`;
}

async function addWebhook() {
  const url = $('#webhookUrl').value.trim();
  if (!url) return;
  const r = await fetch('/api/webhooks', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ url }) });
  const d = await r.json();
  $('#webhookOutput').innerHTML = `<span class="ok">${JSON.stringify(d, null, 2)}</span>`;
  loadWebhooks();
}

async function loadWebhooks() {
  const r = await fetch('/api/webhooks'); const d = await r.json();
  $('#webhookList').innerHTML = (d.webhooks || []).map(w =>
    `<div class="webhook-item"><span class="webhook-url">${w.url}</span><button class="btn btn-outline btn-sm" onclick="testWebhook('${w.id}')">Test</button></div>`
  ).join('');
}

async function testWebhook(id) {
  $('#webhookOutput').innerHTML = '<span class="warn">Testing webhook...</span>';
  const r = await fetch(`/api/webhooks/${id}/test`, { method: 'POST' });
  const d = await r.json();
  $('#webhookOutput').innerHTML = `<span class="${r.ok ? 'ok' : 'err'}">${JSON.stringify(d, null, 2)}</span>`;
}

async function callApi() {
  const endpoint = $('#apiEndpoint').value;
  const method = $('#apiMethod').value;
  const opts = { method };
  if (method === 'POST') { opts.headers = { 'Content-Type': 'application/json' }; opts.body = '{}'; }
  const r = await fetch(endpoint, opts);
  const d = await r.json();
  $('#apiOutput').innerHTML = `<span class="${r.ok ? 'ok' : 'warn'}">${JSON.stringify(d, null, 2)}</span>`;
}

function doLogout() { fetch('/api/auth/logout', { method: 'POST' }).then(() => location.reload()); }
</script>
</body>
</html>

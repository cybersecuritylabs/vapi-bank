<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CloudPay â€” Digital Wallet</title>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;background:linear-gradient(135deg,#f5f3ff 0%,#ede9fe 50%,#f5f3ff 100%);color:#1e293b;min-height:100vh}
.topbar{background:linear-gradient(135deg,#7c3aed,#6d28d9);color:#fff;padding:0 2rem;height:64px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 2px 10px rgba(109,40,217,0.3)}
.topbar h1{font-size:1.25rem;font-weight:700;display:flex;align-items:center;gap:0.5rem}
.topbar h1 svg{width:28px;height:28px}
.container{max-width:800px;margin:2rem auto;padding:0 1.5rem}
.card{background:#fff;border-radius:16px;box-shadow:0 2px 8px rgba(0,0,0,0.06);padding:1.5rem;margin-bottom:1.25rem;border:1px solid #ede9fe}
.card h2{font-size:1rem;font-weight:600;margin-bottom:1rem;display:flex;align-items:center;gap:0.5rem;color:#4c1d95}
.card h2 svg{width:18px;height:18px;color:#8b5cf6}
.wallet-info{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:1rem;margin-bottom:1rem}
.wallet-stat{background:#f5f3ff;border-radius:12px;padding:1rem;text-align:center}
.wallet-stat .label{font-size:0.75rem;color:#7c3aed;font-weight:600;text-transform:uppercase;letter-spacing:0.05em}
.wallet-stat .value{font-size:1.5rem;font-weight:800;color:#4c1d95;margin-top:0.25rem}
.form-row{margin-bottom:1rem}
.form-row label{display:block;font-size:0.8125rem;font-weight:500;color:#475569;margin-bottom:0.375rem}
.form-row input{width:100%;padding:0.625rem 0.875rem;border:1.5px solid #e2e8f0;border-radius:8px;font-size:0.875rem;font-family:inherit}
.form-row input:focus{outline:none;border-color:#7c3aed;box-shadow:0 0 0 3px rgba(124,58,237,0.1)}
.btn{padding:0.625rem 1.25rem;border:none;border-radius:8px;font-size:0.875rem;font-weight:600;cursor:pointer;font-family:inherit;transition:all 0.15s}
.btn-primary{background:#7c3aed;color:#fff;width:100%}.btn-primary:hover{background:#6d28d9}
.btn-sm{padding:0.375rem 0.75rem;font-size:0.75rem}
.btn-danger{background:#ef4444;color:#fff}
.alert{padding:0.75rem;border-radius:8px;font-size:0.8125rem;margin-bottom:1rem;display:none}
.alert-error{background:#fee2e2;color:#991b1b}.alert-success{background:#d1fae5;color:#065f46}
.login-wrapper{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#4c1d95,#7c3aed)}
.login-card{background:#fff;border-radius:16px;padding:2.5rem;max-width:400px;width:100%;box-shadow:0 20px 40px rgba(0,0,0,0.2)}
.login-card h1{text-align:center;font-size:1.375rem;margin-bottom:0.25rem}
.login-card p{text-align:center;color:#64748b;font-size:0.875rem;margin-bottom:2rem}
.login-card .logo{text-align:center;margin-bottom:1.5rem}
.login-card .logo svg{width:48px;height:48px}
.hidden{display:none!important}
.flag-banner{background:linear-gradient(135deg,#10b981,#059669);color:#fff;padding:1rem;border-radius:12px;margin-bottom:1.25rem;font-family:monospace;font-size:0.875rem;word-break:break-all}
.flag-banner strong{display:block;margin-bottom:0.25rem;font-size:0.75rem;text-transform:uppercase;letter-spacing:0.1em;opacity:0.8}
</style>
</head>
<body>
<div id="loginView" class="login-wrapper">
  <div class="login-card">
    <div class="logo"><svg viewBox="0 0 48 48" fill="none"><rect width="48" height="48" rx="16" fill="#7c3aed"/><circle cx="24" cy="24" r="12" fill="none" stroke="#fff" stroke-width="2"/><path d="M20 24h8M24 20v8" stroke="#fff" stroke-width="2" stroke-linecap="round"/></svg></div>
    <h1>CloudPay</h1>
    <p>Digital Wallet Platform</p>
    <div id="loginAlert" class="alert alert-error"></div>
    <form id="loginForm">
      <div class="form-row"><label>Email</label><input type="email" id="email" required></div>
      <div class="form-row"><label>Password</label><input type="password" id="password" required></div>
      <button type="submit" class="btn btn-primary">Sign In</button>
    </form>
  </div>
</div>

<div id="appView" class="hidden">
  <div class="topbar">
    <h1><svg viewBox="0 0 32 32" fill="none"><circle cx="16" cy="16" r="12" fill="rgba(255,255,255,0.15)"/><path d="M13 16h6M16 13v6" stroke="#fff" stroke-width="2" stroke-linecap="round"/></svg> CloudPay</h1>
    <button class="btn btn-danger btn-sm" onclick="doLogout()">Logout</button>
  </div>
  <div class="container">
    <div id="flagBanner"></div>
    <div class="card">
      <h2><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="5" width="20" height="14" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/></svg> Wallet</h2>
      <div class="wallet-info">
        <div class="wallet-stat"><div class="label">Balance</div><div class="value" id="wBalance">$0</div></div>
        <div class="wallet-stat"><div class="label">Credit Line</div><div class="value" id="wCredit">$0</div></div>
        <div class="wallet-stat"><div class="label">Daily Limit</div><div class="value" id="wLimit">$0</div></div>
      </div>
    </div>
    <div class="card">
      <h2><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg> Draw Credit</h2>
      <div id="creditAlert" class="alert"></div>
      <form id="creditForm">
        <div class="form-row"><label>Amount ($)</label><input type="number" id="creditAmount" min="1" required></div>
        <button type="submit" class="btn btn-primary">Draw Credit</button>
      </form>
    </div>
    <div class="card">
      <h2><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/></svg> Profile</h2>
      <div id="profileAlert" class="alert"></div>
      <form id="profileForm">
        <div class="form-row"><label>Name</label><input type="text" id="pName" required></div>
        <div class="form-row"><label>Phone</label><input type="text" id="pPhone"></div>
        <button type="submit" class="btn btn-primary">Update Profile</button>
      </form>
    </div>
  </div>
</div>

<script>
const $ = s => document.querySelector(s);

$('#loginForm').addEventListener('submit', async e => {
  e.preventDefault();
  const res = await fetch('/api/auth/login', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({email:$('#email').value,password:$('#password').value})});
  const data = await res.json();
  if (!res.ok) { $('#loginAlert').textContent=data.error; $('#loginAlert').style.display='block'; return; }
  $('#loginView').classList.add('hidden');
  $('#appView').classList.remove('hidden');
  loadWallet(); loadProfile();
});

async function loadWallet() {
  const res = await fetch('/api/wallet');
  const d = await res.json();
  $('#wBalance').textContent = '$' + d.balance.toLocaleString();
  $('#wCredit').textContent = '$' + d.creditLine.toLocaleString();
  $('#wLimit').textContent = '$' + d.dailyLimit.toLocaleString();
}

async function loadProfile() {
  const res = await fetch('/api/profile');
  const d = await res.json();
  $('#pName').value = d.name;
  $('#pPhone').value = d.phone || '';
}

$('#creditForm').addEventListener('submit', async e => {
  e.preventDefault();
  const alert = $('#creditAlert');
  const res = await fetch('/api/wallet/credit', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({amount:parseFloat($('#creditAmount').value)})});
  const d = await res.json();
  if (!res.ok) { alert.className='alert alert-error'; alert.textContent=d.error; alert.style.display='block'; return; }
  alert.className='alert alert-success'; alert.textContent=d.message; alert.style.display='block';
  if (d.flag) { $('#flagBanner').innerHTML = `<div class="flag-banner"><strong>Flag Captured</strong>${d.flag}</div>`; }
  loadWallet();
});

$('#profileForm').addEventListener('submit', async e => {
  e.preventDefault();
  const alert = $('#profileAlert');
  const res = await fetch('/api/profile', { method:'PUT', headers:{'Content-Type':'application/json'}, body: JSON.stringify({name:$('#pName').value,phone:$('#pPhone').value})});
  const d = await res.json();
  if (!res.ok) { alert.className='alert alert-error'; alert.textContent=d.error; alert.style.display='block'; return; }
  alert.className='alert alert-success'; alert.textContent=d.message; alert.style.display='block';
  loadWallet();
});

function doLogout() {
  fetch('/api/auth/logout',{method:'POST'}).then(()=>{$('#appView').classList.add('hidden');$('#loginView').classList.remove('hidden');});
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QuickTransfer — Payments</title>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;background:#f0fdf4;color:#1e293b;min-height:100vh}
.topbar{background:linear-gradient(135deg,#059669,#10b981);color:#fff;padding:0 2rem;height:60px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 2px 8px rgba(5,150,105,0.3)}
.topbar h1{font-size:1.125rem;font-weight:700;display:flex;align-items:center;gap:0.5rem}
.topbar h1 svg{width:24px;height:24px}
.container{max-width:700px;margin:2rem auto;padding:0 1.5rem}
.card{background:#fff;border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,0.06);padding:1.5rem;margin-bottom:1rem;border:1px solid #d1fae5}
.card h2{font-size:1rem;font-weight:600;margin-bottom:0.75rem;color:#065f46;display:flex;align-items:center;gap:0.5rem}
.card h2 svg{width:18px;height:18px;color:#10b981}
.balance-row{display:flex;gap:1rem;margin-bottom:1rem}
.balance-box{flex:1;background:#f0fdf4;border:1px solid #d1fae5;border-radius:10px;padding:1rem;text-align:center}
.balance-box .label{font-size:0.75rem;color:#059669;font-weight:600;text-transform:uppercase}
.balance-box .value{font-size:1.75rem;font-weight:800;color:#065f46}
.form-row{margin-bottom:1rem}
.form-row label{display:block;font-size:0.8125rem;font-weight:500;color:#475569;margin-bottom:0.375rem}
.form-row input,.form-row select{width:100%;padding:0.625rem;border:1.5px solid #d1fae5;border-radius:8px;font-size:0.875rem;font-family:inherit;background:#fff}
.form-row input:focus,.form-row select:focus{outline:none;border-color:#10b981;box-shadow:0 0 0 3px rgba(16,185,129,0.15)}
.btn{padding:0.625rem 1.25rem;border:none;border-radius:8px;font-size:0.875rem;font-weight:600;cursor:pointer;font-family:inherit;transition:all 0.15s}
.btn-primary{background:#10b981;color:#fff;width:100%}.btn-primary:hover{background:#059669}
.btn-sm{padding:0.375rem 0.75rem;font-size:0.75rem}
.btn-outline{background:transparent;border:1.5px solid #d1fae5;color:#059669}.btn-outline:hover{background:#f0fdf4}
.btn-danger{background:#ef4444;color:#fff}
.alert{padding:0.75rem;border-radius:8px;font-size:0.8125rem;margin-bottom:1rem;display:none}
.alert-error{background:#fee2e2;color:#991b1b}.alert-success{background:#d1fae5;color:#065f46}
.login-wrapper{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#064e3b,#059669)}
.login-card{background:#fff;border-radius:16px;padding:2.5rem;max-width:400px;width:100%;box-shadow:0 20px 40px rgba(0,0,0,0.2)}
.login-card h1{text-align:center;font-size:1.375rem;margin-bottom:0.25rem}
.login-card p{text-align:center;color:#64748b;font-size:0.875rem;margin-bottom:2rem}
.login-card .logo{text-align:center;margin-bottom:1.5rem}
.login-card .logo svg{width:48px;height:48px}
.hidden{display:none!important}
.flag-banner{background:linear-gradient(135deg,#10b981,#059669);color:#fff;padding:1rem;border-radius:12px;margin-bottom:1rem;font-family:monospace;font-size:0.875rem;word-break:break-all}
.flag-banner strong{display:block;margin-bottom:0.25rem;font-size:0.75rem;text-transform:uppercase;letter-spacing:0.1em;opacity:0.8}
</style>
</head>
<body>
<div id="loginView" class="login-wrapper">
  <div class="login-card">
    <div class="logo"><svg viewBox="0 0 48 48" fill="none"><rect width="48" height="48" rx="14" fill="#059669"/><path d="M14 24h20M26 18l8 6-8 6" stroke="#fff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
    <h1>QuickTransfer</h1>
    <p>Instant Payment Platform</p>
    <div id="loginAlert" class="alert alert-error"></div>
    <form id="loginForm">
      <div class="form-row"><label>Username</label><input type="text" id="username" required></div>
      <div class="form-row"><label>Password</label><input type="password" id="password" required></div>
      <button type="submit" class="btn btn-primary">Sign In</button>
    </form>
  </div>
</div>

<div id="appView" class="hidden">
  <div class="topbar">
    <h1><svg viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2"><path d="M7 12h10M13 8l4 4-4 4"/></svg> QuickTransfer</h1>
    <div>
      <button class="btn btn-outline btn-sm" onclick="resetAccounts()">Reset</button>
      <button class="btn btn-danger btn-sm" style="margin-left:0.5rem" onclick="doLogout()">Logout</button>
    </div>
  </div>
  <div class="container">
    <div id="flagBanner"></div>
    <div class="card">
      <h2><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="5" width="20" height="14" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/></svg> Account</h2>
      <div class="balance-row">
        <div class="balance-box"><div class="label">Balance</div><div class="value" id="balance">$0</div></div>
        <div class="balance-box"><div class="label">Total Transferred</div><div class="value" id="transferred">$0</div></div>
      </div>
    </div>
    <div class="card">
      <h2><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="7" y1="12" x2="17" y2="12"/><path d="M13 8l4 4-4 4"/></svg> Send Payment</h2>
      <div id="txAlert" class="alert"></div>
      <form id="txForm">
        <div class="form-row"><label>Recipient</label><input type="text" id="toUser" value="receiver" readonly></div>
        <div class="form-row"><label>Amount ($)</label><input type="number" id="txAmount" min="1" value="1000" required></div>
        <button type="submit" class="btn btn-primary">Send</button>
      </form>
    </div>
  </div>
</div>

<script>
const $ = s => document.querySelector(s);

$('#loginForm').addEventListener('submit', async e => {
  e.preventDefault();
  const res = await fetch('/api/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:$('#username').value,password:$('#password').value})});
  const d = await res.json();
  if (!res.ok) {$('#loginAlert').textContent=d.error;$('#loginAlert').style.display='block';return;}
  $('#loginView').classList.add('hidden');$('#appView').classList.remove('hidden');
  loadAccount();
});

async function loadAccount() {
  const res = await fetch('/api/account');
  const d = await res.json();
  $('#balance').textContent = '$' + d.balance.toLocaleString();
  $('#transferred').textContent = '$' + d.totalTransferred.toLocaleString();
  if (d.flag) { $('#flagBanner').innerHTML = `<div class="flag-banner"><strong>Flag Captured</strong>${d.flag}</div>`; }
}

$('#txForm').addEventListener('submit', async e => {
  e.preventDefault();
  const alert = $('#txAlert');
  const res = await fetch('/api/transfer',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({to:$('#toUser').value,amount:parseFloat($('#txAmount').value)})});
  const d = await res.json();
  if (!res.ok) {alert.className='alert alert-error';alert.textContent=d.error;alert.style.display='block';} else {alert.className='alert alert-success';alert.textContent=d.message+' — TxID: '+d.transactionId;alert.style.display='block';}
  loadAccount();
});

async function resetAccounts() { await fetch('/api/reset',{method:'POST'}); loadAccount(); }
function doLogout() { fetch('/api/auth/logout',{method:'POST'}).then(()=>{$('#appView').classList.add('hidden');$('#loginView').classList.remove('hidden');}); }
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NexaPay — Digital Banking</title>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:#f0f4f8;color:#1e293b;min-height:100vh}
.topbar{background:linear-gradient(135deg,#1e3a5f 0%,#2563eb 100%);color:#fff;padding:0 2rem;height:64px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 2px 8px rgba(0,0,0,0.15)}
.topbar h1{font-size:1.25rem;font-weight:700;display:flex;align-items:center;gap:0.5rem}
.topbar h1 svg{width:28px;height:28px}
.topbar .user-badge{font-size:0.8125rem;background:rgba(255,255,255,0.15);padding:0.375rem 0.75rem;border-radius:999px}
.container{max-width:900px;margin:2rem auto;padding:0 1.5rem}
.card{background:#fff;border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,0.08);padding:1.5rem;margin-bottom:1.25rem;border:1px solid #e2e8f0}
.card h2{font-size:1.125rem;font-weight:600;margin-bottom:1rem;color:#1e293b;display:flex;align-items:center;gap:0.5rem}
.card h2 svg{width:20px;height:20px;color:#64748b}
.balance-display{font-size:2.5rem;font-weight:800;color:#2563eb;margin:0.5rem 0}
.balance-label{font-size:0.8125rem;color:#64748b;text-transform:uppercase;letter-spacing:0.05em}
.form-row{margin-bottom:1rem}
.form-row label{display:block;font-size:0.8125rem;font-weight:500;color:#475569;margin-bottom:0.375rem}
.form-row input,.form-row select{width:100%;padding:0.625rem 0.875rem;border:1.5px solid #e2e8f0;border-radius:8px;font-size:0.875rem;font-family:inherit;background:#fff}
.form-row input:focus,.form-row select:focus{outline:none;border-color:#2563eb;box-shadow:0 0 0 3px rgba(37,99,235,0.1)}
.btn{padding:0.625rem 1.25rem;border:none;border-radius:8px;font-size:0.875rem;font-weight:600;cursor:pointer;font-family:inherit;transition:all 0.15s}
.btn-primary{background:#2563eb;color:#fff}.btn-primary:hover{background:#1d4ed8}
.btn-danger{background:#ef4444;color:#fff}.btn-danger:hover{background:#dc2626}
.btn-block{width:100%}
.transactions{list-style:none}
.transactions li{display:flex;justify-content:space-between;padding:0.75rem 0;border-bottom:1px solid #f1f5f9;font-size:0.875rem}
.transactions li:last-child{border-bottom:none}
.tx-amount{font-weight:600}
.tx-credit{color:#10b981}.tx-debit{color:#ef4444}
.login-wrapper{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#0f172a,#1e3a5f)}
.login-card{background:#fff;border-radius:16px;padding:2.5rem;width:100%;max-width:400px;box-shadow:0 20px 40px rgba(0,0,0,0.2)}
.login-card h1{font-size:1.5rem;font-weight:700;text-align:center;margin-bottom:0.25rem;color:#1e293b}
.login-card p{text-align:center;color:#64748b;font-size:0.875rem;margin-bottom:2rem}
.login-card .logo{text-align:center;margin-bottom:1.5rem}
.login-card .logo svg{width:48px;height:48px}
.alert{padding:0.75rem;border-radius:8px;font-size:0.8125rem;margin-bottom:1rem;display:none}
.alert-error{background:#fee2e2;color:#991b1b;border:1px solid #fecaca}
.alert-success{background:#d1fae5;color:#065f46;border:1px solid #a7f3d0}
.hidden{display:none!important}
.flag-banner{background:linear-gradient(135deg,#10b981,#059669);color:#fff;padding:1rem 1.5rem;border-radius:12px;margin-bottom:1.25rem;font-family:'SF Mono','Fira Code',monospace;font-size:0.875rem;word-break:break-all}
.flag-banner strong{display:block;font-family:inherit;margin-bottom:0.25rem;font-size:0.75rem;text-transform:uppercase;letter-spacing:0.1em;opacity:0.8}
</style>
</head>
<body>
<!-- LOGIN VIEW -->
<div id="loginView" class="login-wrapper">
  <div class="login-card">
    <div class="logo">
      <svg viewBox="0 0 48 48" fill="none"><rect width="48" height="48" rx="12" fill="#1e3a5f"/><path d="M12 18h24v2H12zM12 24h18v2H12zM12 30h12v2H12z" fill="#fff" opacity="0.8"/><circle cx="34" cy="30" r="6" fill="#2563eb"/><path d="M32 30h4M34 28v4" stroke="#fff" stroke-width="1.5" stroke-linecap="round"/></svg>
    </div>
    <h1>NexaPay</h1>
    <p>Digital Banking Platform</p>
    <div id="loginAlert" class="alert alert-error"></div>
    <form id="loginForm">
      <div class="form-row"><label>Username</label><input type="text" id="username" required></div>
      <div class="form-row"><label>Password</label><input type="password" id="password" required></div>
      <button type="submit" class="btn btn-primary btn-block">Sign In</button>
    </form>
  </div>
</div>

<!-- APP VIEW -->
<div id="appView" class="hidden">
  <div class="topbar">
    <h1>
      <svg viewBox="0 0 32 32" fill="none"><rect width="32" height="32" rx="8" fill="rgba(255,255,255,0.15)"/><path d="M8 12h16v1.5H8zM8 16h12v1.5H8zM8 20h8v1.5H8z" fill="#fff" opacity="0.9"/></svg>
      NexaPay
    </h1>
    <div>
      <span class="user-badge" id="userBadge">customer1</span>
      <button class="btn btn-danger" style="margin-left:0.5rem;padding:0.375rem 0.75rem;font-size:0.75rem;" onclick="doLogout()">Logout</button>
    </div>
  </div>
  <div class="container">
    <div id="flagBanner"></div>
    <div class="card">
      <h2><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="5" width="20" height="14" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/></svg> Account Overview</h2>
      <div class="balance-label">Available Balance</div>
      <div class="balance-display" id="balanceDisplay">$0.00</div>
      <div style="font-size:0.8125rem;color:#64748b;" id="accountNum">Account: ---</div>
    </div>
    <div class="card">
      <h2><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg> Transfer Funds</h2>
      <div id="transferAlert" class="alert"></div>
      <form id="transferForm">
        <div class="form-row"><label>Recipient Account Number</label><input type="text" id="toAccount" placeholder="ACC-XXXX" required></div>
        <div class="form-row"><label>Amount ($)</label><input type="number" id="amount" min="1" step="0.01" required></div>
        <button type="submit" class="btn btn-primary btn-block">Send Transfer</button>
      </form>
    </div>
    <div class="card">
      <h2><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg> Recent Transactions</h2>
      <ul class="transactions" id="transactions"></ul>
    </div>
  </div>
</div>

<script>
const $ = s => document.querySelector(s);
let currentAccount = null;

$('#loginForm').addEventListener('submit', async e => {
  e.preventDefault();
  try {
    const res = await fetch('/api/auth/login', {
      method: 'POST', headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ username: $('#username').value, password: $('#password').value })
    });
    const data = await res.json();
    if (!res.ok) { $('#loginAlert').textContent = data.error; $('#loginAlert').style.display = 'block'; return; }
    currentAccount = data.account;
    $('#loginView').classList.add('hidden');
    $('#appView').classList.remove('hidden');
    $('#userBadge').textContent = currentAccount.name;
    loadAccount();
  } catch(e) { $('#loginAlert').textContent = 'Connection failed'; $('#loginAlert').style.display = 'block'; }
});

async function loadAccount() {
  const res = await fetch('/api/accounts/me');
  const data = await res.json();
  $('#balanceDisplay').textContent = '$' + data.balance.toLocaleString('en-US', {minimumFractionDigits:2});
  $('#accountNum').textContent = 'Account: ' + data.accountNumber;
  if (data.flag) {
    $('#flagBanner').innerHTML = `<div class="flag-banner"><strong>Flag Captured</strong>${data.flag}</div>`;
  }
  const txRes = await fetch('/api/transactions');
  const txData = await txRes.json();
  $('#transactions').innerHTML = txData.transactions.map(t =>
    `<li><span>${t.date} — ${t.description}</span><span class="tx-amount ${t.type==='credit'?'tx-credit':'tx-debit'}">${t.type==='credit'?'+':'-'}$${t.amount.toLocaleString()}</span></li>`
  ).join('');
}

$('#transferForm').addEventListener('submit', async e => {
  e.preventDefault();
  const alert = $('#transferAlert');
  try {
    const meRes = await fetch('/api/accounts/me');
    const me = await meRes.json();
    const res = await fetch('/api/transfers', {
      method: 'POST', headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ fromAccount: me.accountNumber, toAccount: $('#toAccount').value, amount: parseFloat($('#amount').value), transferToken: me.transferToken || '' })
    });
    const data = await res.json();
    if (!res.ok) { alert.className='alert alert-error'; alert.textContent=data.error; alert.style.display='block'; return; }
    alert.className='alert alert-success'; alert.textContent=data.message; alert.style.display='block';
    loadAccount();
  } catch(e) { alert.className='alert alert-error'; alert.textContent='Transfer failed'; alert.style.display='block'; }
});

function doLogout() {
  fetch('/api/auth/logout', {method:'POST'}).then(() => {
    $('#appView').classList.add('hidden');
    $('#loginView').classList.remove('hidden');
    $('#loginAlert').style.display = 'none';
  });
}
</script>
</body>
</html>
